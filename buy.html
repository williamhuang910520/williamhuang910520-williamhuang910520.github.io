<!doctype html>
<html lang="tw">

<head>
    <title>HusTissue</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS v5.0.2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!--登入api-->
    <script
    src="https://code.jquery.com/jquery-3.6.0.js"
    integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
    <script src="jquery.cookie.js"></script>
    <script src="login.js"></script>
    <!--登入api-->
    <link rel="stylesheet" href="/src/style.css">

    <script src="hide-navbar.js"></script>
</head>

<body class="bg-dark">

    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>

    <!-- <div class="container"> -->
    <nav id="navbar" class="navbar navbar-expand-sm navbar-dark bg-dark  ">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center flex-row-reverse " href="/index.html">
                <div class="padding-left">HusTissue</div>
                <img src="/src/image/logo.png" width="35" height="35" class="d-inline-block align-text-top ">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
                aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <form class="d-flex">
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    <ul class="navbar-nav" id="lnavbarliItems">

                        <li class="nav-item">
                            <a class="nav-link active" href="/about-us.html">關於我們</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/tech.html">技術規格</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/buy.html">購買</a>
                        </li>
                    </ul>
                    <a class="btn-coolest" id="login-member-center" href="/login.html">登入</a>
                </div>
            </form>
        </div>
    </nav>

    <section id="buy1" class="buy">
        <div class="container page-head">
            <div class="row">
                <div class="col-4 offset-1 col-12-sm">
                    <div class="imgbox">
                        <img id="imgbox-img" src="/src/image/_2.png" width=250px alt="">
                    </div>
                    <div class="color-panel">
                        <div class="panel-row">
                            <div id="circle1" class="circle-round">
                                <div class="circle color-red"></div>
                            </div>
                            <div id="circle2" class="circle-round">
                                <div class="circle color-org"></div>
                            </div>
                            <div id="circle3" class="circle-round">
                                <div class="circle color-pink"></div>
                            </div>
                            <div id="circle4" class="circle-round">
                                <div class="circle color-cyan"></div>
                            </div>
                        </div>
                        <div class="panel-row">
                            <div id="circle5" class="circle-round">
                                <div class="circle color-green"></div>
                            </div>
                            <div id="circle6" class="circle-round">
                                <div class="circle color-blue"></div>
                            </div>
                            <div id="circle7" class="circle-round">
                                <div class="circle color-black"></div>
                            </div>
                            <div id="circle8" class="circle-round">
                                <div class="circle color-white"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 offset-1 col-12-sm">
                    <!-- <h5 class="new">全新</h5> -->
                    <h2 class="buy-h2">購買 HusTissue</h2>
                    <h5 class="shape">款式</h5>
                    <div class="button-container">
                        <div class="button button-onSelected">
                            <h5>HusTissue</h5>
                            <p>庶民的高科技體驗</p>
                        </div>
                        <div class="button">
                            <h5>HusTissue PRO</h5>
                            <p>進階的的高科技體驗</p>
                        </div>
                        <div class="button">
                            <h5>HusTissue ULTRA</h5>
                            <p>極致的高科技體驗</p>
                        </div>
                    </div>

                    <h5 class="shape">數量</h5>
                    <div class="d-flex justify-content-between">
                        <div id='counter' method='POST' action='#'>
                            <button type='button' class='qtyminus' field='quantity'>-</button>
                            <input type='text' name='quantity' value='0' class='qty' />
                            <button type='button' class='qtyplus' field='quantity'>+</button>
                        </div>

                        <div class="d-flex align-items-end" style="margin-right: 27px">
                            <button class="btn-coolest2" onclick="addToCart()">加入購物車</button>
                            <button class="btn-coolest2" onclick="directPurchase()">直接購買</button>
                        </div>
                    </div>

                </div>


            </div>
        </div>
    </section>




    <section id="footer" class="container">
        <div class="row">
            <div class="col-12-sm footer">
                <div class="footer-shop" x-ms-format-detection="none">
                    更多選購方式：<a href="#" data-analytics-title="find an apple store">尋找當地的 HusTissue 直營店</a>或<a href="#"
                        data-analytics-title="other retailers or resellers" data-analytics-exit-link="">其他零售商</a>，<span
                        class="nowrap">或致電 0800-123-456。</span>
                </div>
                <div class="footer-locale">
                    <a class="ac-gf-footer-locale-link" href="#" title="選擇你的國家或地區" aria-label="台灣. 選擇你的國家或地區"
                        data-analytics-title="choose your country">台灣</a>
                </div>
                <div class="footer-legal">
                    <div class="footer-legal-copyright">Copyright © 2022 HusTissue Inc. 保留一切權利。</div>
                    <div class="footer-legal-links">
                        <a class="footer-legal-link" href="/tw/legal/privacy/">隱私權政策</a>
                        <a class="footer-legal-link" href="/tw/legal/internet-services/terms/site.html">使用條款</a>
                        <a class="footer-legal-link" href="/tw/shop/goto/help/sales_refunds">銷售及退款</a>
                        <a class="footer-legal-link" href="/tw/legal/">法律聲明</a>
                        <a class="footer-legal-link" href="/tw/sitemap/">網站地圖</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- </div> -->

    <script>
        var carts=[];
        $("#circle1").toggleClass("circle-round-onSelected");
        for (var i = 1; i <= 8; i++) {
            var ID = "circle" + i;
            var oDiv = document.getElementById(ID);
            oDiv.addEventListener("click", function () {
                // html = '<div class="color-panel circle-round"></div>';
                $(".circle-round").removeClass("circle-round-onSelected");
                $("#" + this.id).toggleClass("circle-round-onSelected");
                var img = "/src/image/_1.png";
                switch (this.id) {
                    case "circle1":
                        img = "/src/image/_2.png";
                        break;
                    case "circle2":
                        img = "/src/image/_1.png";
                        break;
                    case "circle3":
                        img = "/src/image/_6.png";
                        break;
                    case "circle4":
                        img = "/src/image/_3.png";
                        break;
                    case "circle5":
                        img = "/src/image/_5.png";
                        break;
                    case "circle6":
                        img = "/src/image/_4.png";
                        break;
                    case "circle7":
                        img = "/src/image/_8.png";
                        break;
                    case "circle8":
                        img = "/src/image/_7.png";
                        break;
                    default:
                        img = "/src/image/_2.png";
                };
                $("#imgbox-img").removeAttr();
                $("#imgbox-img").attr("src", img);

                // console.log(this.id);
            });
            // console.log(oDiv);
        }

        $(function () {
            // This button will increment the value
            $('.qtyplus').click(function (e) {
                // Stop acting like a button
                e.preventDefault();
                // Get the field name
                fieldName = $(this).attr('field');
                // Get its current value
                var currentVal = parseInt($('input[name=' + fieldName + ']').val());
                // If is not undefined
                if (!isNaN(currentVal)) {
                    // Increment
                    $('input[name=' + fieldName + ']').val(currentVal + 1);
                } else {
                    // Otherwise put a 0 there
                    $('input[name=' + fieldName + ']').val(0);
                }
            });
            // This button will decrement the value till 0
            $(".qtyminus").click(function (e) {
                // Stop acting like a button
                e.preventDefault();
                // Get the field name
                fieldName = $(this).attr('field');
                // Get its current value
                var currentVal = parseInt($('input[name=' + fieldName + ']').val());
                // If it isn't undefined or its greater than 0
                if (!isNaN(currentVal) && currentVal > 0) {
                    // Decrement one
                    $('input[name=' + fieldName + ']').val(currentVal - 1);
                } else {
                    // Otherwise put a 0 there
                    $('input[name=' + fieldName + ']').val(0);
                }
            });
        });

        $(".button-container>.button").each(function () {
            $(this).click(() => {
                $(".button-container>.button").removeClass("button-onSelected");
                $(this).addClass("button-onSelected");
            })
        })



        function addToCart() {
            let name = $(".button-container>.button-onSelected").find("h5").text();
            // TODO convert id to color


            let color = $(".circle-round-onSelected").attr("id");
            switch(color)
            {
                case "circle1":
                color="red";
                    break;
                    case "circle2":
                    color="org";
                    break;
                    case "circle3":
                    color="pink";
                    break;
                    case "circle4":
                    color="cyan";
                    break;
                    case "circle5":
                    color="green";
                    break;
                    case "circle6":
                    color="blue";
                    break;
                    case "circle7":
                    color="black";
                    break;0
                    case "circle8":
                    color="white";
                    break;
            }
            let count = parseInt($('input[name=' + fieldName + ']').val());
            console.log({
                "name": name,
                "color": color,
                "count": count
            });
            if(count!=0&&name.length!=0)
            {
            let notfindsame=true;
            for(var i=0;i<carts.length;i++)
            {
                if(carts[i].color==color&&carts[i].name==name)
                {
                    notfindsame=false;
                    carts[i].count+=count;
                }
            }
            if(notfindsame)
            {
            carts.push({"name": name,
                "color": color,
                "count": count});
               
            }
            console.log(carts);
            }
            // TODO add to cart
        }

        function directPurchase() {
            addToCart();
            let sendorder=
            {
                Session: $.cookie('session'),
                purchaseitems:carts
            }
            $.ajax({
        url: backendurl+'/api/purchase',
        type: 'POST',
        data: JSON.stringify(sendorder),
        contentType: 'application/json',
        dataType: 'json',
        success: function(data){
            //carts=[];
            $.cookie('toorders',true)
            window.location="/account.html";
        }

        });


            // TODO direct purchase
        }
    </script>
</body>

</html>